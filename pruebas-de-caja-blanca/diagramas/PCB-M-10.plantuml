@startuml
!theme plain
skinparam monochrome true
skinparam shadowing false
skinparam defaultFontName Arial
skinparam ArrowFontSize 11

title Función updateOrderStatus

start

:Recibir parámetros:
- orderId
- newStatus
- adminId
- notes (opcional);

if (¿orderId, newStatus y adminId existen?) then (no)
  :Lanzar error:
  "Todos los parámetros son obligatorios";
  stop
endif

:Obtener referencia del documento de pedido;

:Intentar obtener el pedido actual;

if (¿Pedido existe?) then (no)
  :Lanzar error:
  "Pedido no encontrado";
  stop
endif

:Extraer currentStatus del pedido;

note right
  Los estados válidos son:
  pending, processing, shipped,
  delivered, completed, cancelled
end note

if (¿Es una transición válida?) then (no)
  :Lanzar error:
  "Transición de estado no válida";
  stop
endif

:Crear registro histórico 
del cambio de estado;

:Crear objeto de actualización
con nuevo estado y registro histórico;

:Actualizar documento del pedido;

if (¿newStatus es "shipped"?) then (sí)
  :Agregar datos de envío
  al objeto de actualización;
endif

if (¿newStatus es "completed" o "cancelled"?) then (sí)
  :Marcar el pedido como cerrado
  en el objeto de actualización;
endif

if (¿Notificar al cliente?) then (sí)
  :Enviar notificación según
  el nuevo estado;
endif

:Retornar el pedido actualizado
con el nuevo estado;

stop

@enduml 