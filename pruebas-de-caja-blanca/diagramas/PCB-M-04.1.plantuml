@startuml PCB-M-04.1
!theme plain
skinparam monochrome true
skinparam shadowing false
skinparam defaultFontName Arial
skinparam ArrowFontSize 11

title Componente RequireAdminAuth Refactorizado

start

:1. Iniciar componente RequireAdminAuth;

:2. Establecer estados iniciales 
role = null, loading = true;

:3. Ejecutar useEffect con checkUserRole();

partition "checkUserRole()" {
  :4. Intentar obtener rol del usuario;
  
  note right
    Llama a getUserRole() que:
    - Verifica usuario actual
    - Obtiene token con claims
    - Retorna rol o "visitor"
  end note
  
  if (5. ¿Error en obtención del rol?) then (sí)
    :6. Registrar error en consola;
    :7. Establecer role = "visitor";
  else (no)
    :8. Establecer role = resultado de getUserRole;
  endif
  
  :9. Establecer loading = false;
}

if (10. ¿loading es true?) then (sí)
  :11. Renderizar <LoadingSpinner message="Verificando permisos..." />;
else (no)
  if (12. ¿role es "admin" o "superadmin"?) then (sí)
    :13. Renderizar <Outlet />;
    note right: Muestra contenido protegido
  else (no)
    :14. Renderizar <Navigate to="/admin/login" replace />;
    note right: Redirige al login
  endif
endif

stop

@enduml 