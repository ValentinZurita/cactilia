@startuml PCB-A-04
!theme plain
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontColor black
skinparam arrowColor black
skinparam shadowing false

title Cálculo de Subtotales
start
if (items válidos?) then (no)
  :Retornar valores por defecto;
  note right: subtotal: 0, taxes: 0, shipping: 0, etc.
  stop
else (sí)
  :Calcular total con impuestos incluidos;
  note right: Suma de price * quantity
  :Calcular impuestos;
  note right: taxes = total - (total / (1 + taxRate))
  :Calcular subtotal;
  note right: subtotal = total - taxes
  if (total >= minFreeShipping?) then (sí)
    :Establecer shipping = 0;
    :Establecer isFreeShipping = true;
  else (no)
    :Establecer shipping = shippingCost;
    :Establecer isFreeShipping = false;
  endif
  :Calcular finalTotal;
  note right: finalTotal = total + shipping
  :Retornar objeto con subtotal, taxes, shipping, etc.;
  stop
endif
@enduml