@startuml PCB-A-04.1
!theme plain
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontColor black
skinparam arrowColor black
skinparam shadowing false

title Cálculo de Subtotales

start
:1. Inicio calculateCartTotals;

if (2. ¿items es array no vacío?) then (No)
  :2a. Retornar valores por defecto;
  note right: subtotal: 0, taxes: 0, shipping: 0,\ntotal: 0, finalTotal: 0, isFreeShipping: true
  stop
else (Sí)
  :2b. Inicializar total = 0;
  
  :3. Iterar sobre cada item;
  
  repeat
    :3a. Validar price y quantity;
    note right: Si price no es número, usar 0\nSi quantity no es número, usar 1
    
    :3b. Sumar (price * quantity) al total;
  repeat while (¿Quedan más items?) is (Sí)
  ->No;
  
  :4. Calcular impuestos;
  note right: taxes = total - (total / (1 + taxRate))
  
  :5. Calcular subtotal;
  note right: subtotal = total - taxes
  
  if (6. ¿total >= minFreeShipping?) then (Sí)
    :6a. Establecer shipping = 0;
    :6b. Establecer isFreeShipping = true;
  else (No)
    :6c. Establecer shipping = shippingCost;
    :6d. Establecer isFreeShipping = false;
  endif
  
  :7. Calcular finalTotal;
  note right: finalTotal = total + shipping
  
  :8. Retornar objeto con subtotal,\ntaxes, shipping, total,\nfinalTotal, isFreeShipping;
  
endif

stop

@enduml 