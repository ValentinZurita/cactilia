@startuml PCB-A-10
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 12

!define MAIN_COLOR #1a237e
!define SECONDARY_COLOR #283593
!define PROCESS_COLOR #c5cae9
!define DECISION_COLOR #e8eaf6

' Nodos y conectores
start
:Inicio **generateOrderSummary**;

if (¿Carrito válido?) then (No)
  #DECISION_COLOR:Lanzar Error **"Se requiere un carrito con ítems"**;
  stop
else (Sí)
  if (¿Usuario válido?) then (No)
    #DECISION_COLOR:Lanzar Error **"Se requieren datos del usuario"**;
    stop
  else (Sí)
    if (¿Dirección de envío válida?) then (No)
      #DECISION_COLOR:Lanzar Error **"Se requiere dirección de envío"**;
      stop
    else (Sí)
      if (¿Método de envío válido?) then (No)
        #DECISION_COLOR:Lanzar Error **"Se requiere método de envío"**;
        stop
      else (Sí)
        if (¿Método de pago válido?) then (No)
          #DECISION_COLOR:Lanzar Error **"Se requiere método de pago"**;
          stop
        else (Sí)
          if (¿Carrito tiene productos?) then (No)
            #DECISION_COLOR:Lanzar Error **"El carrito no tiene productos"**;
            stop
          else (Sí)
            try
              #PROCESS_COLOR:Verificar disponibilidad de productos;
              
              #PROCESS_COLOR:Verificar stock de cada producto;
              
              #PROCESS_COLOR:Marcar productos sin stock como no disponibles;
              
              #PROCESS_COLOR:Calcular si hay productos no disponibles;
              
              #PROCESS_COLOR:Calcular totales 
              (subtotal, envío, impuestos, descuento, total);
              
              if (¿Pago con tarjeta?) then (Sí)
                #PROCESS_COLOR:Formatear método como **"Tarjeta terminada en XXXX"**;
              else (No)
                if (¿Pago con PayPal?) then (Sí)
                  #PROCESS_COLOR:Formatear método como **"PayPal (email)"**;
                else (No)
                  #PROCESS_COLOR:Formatear como **"Método de pago seleccionado"**;
                endif
              endif
              
              #PROCESS_COLOR:Generar número de orden;
              
              #PROCESS_COLOR:Estructurar datos del resumen de pedido;
              
              if (¿Tiene código de cupón?) then (Sí)
                #PROCESS_COLOR:Añadir información del cupón al resumen;
              else (No)
                ' Continúa sin añadir cupón
              endif
              
              #PROCESS_COLOR:Retornar resumen completo;
            catch
              #DECISION_COLOR:Lanzar Error **"No se pudo generar el resumen del pedido"**;
              stop
            end try
          endif
        endif
      endif
    endif
  endif
endif

stop
@enduml 