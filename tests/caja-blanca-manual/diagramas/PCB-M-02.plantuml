@startuml
!theme plain
skinparam monochrome true
skinparam shadowing false
skinparam defaultFontName Arial
skinparam ArrowFontSize 11

start
' 1
:1. checkingCredentials();

note right
  Inicio del proceso de autenticación
  Cambia el estado a "checking"
end note

partition "Bloque Try" {
  ' 2
  :2. signInWithEmailAndPassword();
  
  ' 3 - Decisión 1
  if (¿Credenciales válidas?) then (Sí)
    ' 4 - Decisión 2
    if (¿Email verificado?) then (Sí)
      ' 5
      :5. dispatch(login());
      note right: Almacena datos del usuario
    else (No)
      ' 6
      :6. sendEmailVerification();
      ' 7
      :7. FirebaseAuth.signOut();
      ' 8
      :8. dispatch(logout());
      note right: Con mensaje: "Verifica tu correo"
    endif
  else (No)
    ' 9
    :9. Error en inicio de sesión;
    ' 10
    :10. dispatch(logout());
  endif
}

partition "Bloque Catch" {
  ' 11
  :11. Manejo de error;
  note right: Captura cualquier excepción
  ' 12
  :12. dispatch(logout());
  note right: Con mensaje: "Error al iniciar sesión"
}

stop

@enduml