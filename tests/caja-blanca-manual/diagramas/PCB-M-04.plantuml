@startuml
!theme plain
skinparam monochrome true
skinparam shadowing false
skinparam defaultFontName Arial
skinparam ArrowFontSize 11

start
note right: RequireAdminAuth Component

' 1
:1. Iniciar verificación de autenticación;
:2. Establecer loading = true;

' 3
:3. Verificar usuario actual en Firebase;

' 4 - Decisión 1
if (¿Existe usuario?) then (No)
  ' 5
  :5. Establecer rol = "visitor";
  :6. Establecer loading = false;
else (Sí)
  ' 7
  :7. Llamar a función getUserRole();
  note right: Obtiene token y claims
  
  ' 8 - Decisión 2
  if (¿Obtención exitosa?) then (Sí)
    ' 9 - Decisión 3
    if (¿Tiene claim de rol?) then (Sí)
      ' 10
      :10. Establecer rol = valor del claim;
    else (No)
      ' 11
      :11. Establecer rol = "visitor";
    endif
  else (Error)
    ' 12
    :12. Establecer rol = "visitor";
    :13. Registrar error en consola;
  endif
  
  ' 14
  :14. Establecer loading = false;
endif

' 15 - Decisión 4
if (¿loading es true?) then (Sí)
  ' 16
  :16. Mostrar indicador de carga;
  stop
endif

' 17 - Decisión 5
if (¿rol es "admin" o "superadmin"?) then (Sí)
  ' 18
  :18. Renderizar contenido protegido;
  note right: <Outlet />
else (No)
  ' 19
  :19. Redirigir a página de inicio de sesión;
  note right: <Navigate to="/admin/login" replace />
endif

stop
@enduml